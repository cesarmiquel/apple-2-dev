!cpu 6502

           *= $a0 ; ORG = $A0

; =====================================
; PAGE ZERO
BUFFER              = $01       ; 00 - 1f buffer space
PTRFG               = $a1       ; reuse beginning of code
PTRBG               = $9f

PATTERN_LENGTH      = 40

!zone
            jsr $fb40
            nop

.start
            ldy #PATTERN_LENGTH*2

; Fill buffer with bars to render
.loopinit

            lda (PTRFG),y
            ror
            bcc +
            lda #$ff
            bne .save
+           lda (PTRBG),y
            and #%00000001
            beq .save
            lda #$11
.save
            dey
            sta BUFFER,y
            bne .loopinit

; Blit buffer to screen as bars
.blitbuffer
            ldx #0
-           lda BUFFER,x
            sta $400,y
            sta $480,y
            sta $500,y
            sta $580,y
            iny
            inx
            cpx #PATTERN_LENGTH
            bne -
            cpy #40*3
            bmi .blitbuffer

.delay
            lda #$80
            jsr $fca8

            dec PTRFG
;            inc PTRBG

            bcs .start
